jQuery.iDrag={helper:null,dragged:null,destroy:function(){return this.each(function(){if(this.isDraggable){this.dragCfg.dhe.unbind("mousedown",jQuery.iDrag.draginit);this.dragCfg=null;this.isDraggable=false;if(jQuery.browser.msie)this.unselectable="off";else{this.style.MozUserSelect="";this.style.KhtmlUserSelect="";this.style.userSelect=""}}})},draginit:function(a){if(jQuery.iDrag.dragged!=null){jQuery.iDrag.dragstop(a);return false}var b=this.dragElem;jQuery(document).bind("mousemove",jQuery.iDrag.dragmove).bind("mouseup", jQuery.iDrag.dragstop);b.dragCfg.pointer=jQuery.iUtil.getPointer(a);b.dragCfg.currentPointer=b.dragCfg.pointer;b.dragCfg.init=false;b.dragCfg.fromHandler=this!=this.dragElem;jQuery.iDrag.dragged=b;if(b.dragCfg.si&&this!=this.dragElem){parentPos=jQuery.iUtil.getPosition(b.parentNode);sliderSize=jQuery.iUtil.getSize(b);sliderPos={x:parseInt(jQuery.css(b,"left"))||0,y:parseInt(jQuery.css(b,"top"))||0};dx=b.dragCfg.currentPointer.x-parentPos.x-sliderSize.wb/2-sliderPos.x;dy=b.dragCfg.currentPointer.y- parentPos.y-sliderSize.hb/2-sliderPos.y;jQuery.iSlider.dragmoveBy(b,[dx,dy])}return jQuery.selectKeyHelper||false},dragstart:function(){var a=jQuery.iDrag.dragged;a.dragCfg.init=true;var b=a.style;a.dragCfg.oD=jQuery.css(a,"display");a.dragCfg.oP=jQuery.css(a,"position");if(!a.dragCfg.initialPosition)a.dragCfg.initialPosition=a.dragCfg.oP;a.dragCfg.oR={x:parseInt(jQuery.css(a,"left"))||0,y:parseInt(jQuery.css(a,"top"))||0};a.dragCfg.diffX=0;a.dragCfg.diffY=0;if(jQuery.browser.msie){var c=jQuery.iUtil.getBorder(a, true);a.dragCfg.diffX=c.l||0;a.dragCfg.diffY=c.t||0}a.dragCfg.oC=jQuery.extend(jQuery.iUtil.getPosition(a),jQuery.iUtil.getSize(a));if(a.dragCfg.oP!="relative"&&a.dragCfg.oP!="absolute")b.position="relative";jQuery.iDrag.helper.empty();c=a.cloneNode(true);jQuery(c).css({display:"block",left:"0px",top:"0px"});c.style.marginTop="0";c.style.marginRight="0";c.style.marginBottom="0";c.style.marginLeft="0";jQuery.iDrag.helper.append(c);var d=jQuery.iDrag.helper.get(0).style;if(a.dragCfg.autoSize){d.width= "auto";d.height="auto"}else{d.height=a.dragCfg.oC.hb+"px";d.width=a.dragCfg.oC.wb+"px"}d.display="block";d.marginTop="0px";d.marginRight="0px";d.marginBottom="0px";d.marginLeft="0px";jQuery.extend(a.dragCfg.oC,jQuery.iUtil.getSize(c));if(a.dragCfg.cursorAt){if(a.dragCfg.cursorAt.left){a.dragCfg.oR.x+=a.dragCfg.pointer.x-a.dragCfg.oC.x-a.dragCfg.cursorAt.left;a.dragCfg.oC.x=a.dragCfg.pointer.x-a.dragCfg.cursorAt.left}if(a.dragCfg.cursorAt.top){a.dragCfg.oR.y+=a.dragCfg.pointer.y-a.dragCfg.oC.y-a.dragCfg.cursorAt.top; a.dragCfg.oC.y=a.dragCfg.pointer.y-a.dragCfg.cursorAt.top}if(a.dragCfg.cursorAt.right){a.dragCfg.oR.x+=a.dragCfg.pointer.x-a.dragCfg.oC.x-a.dragCfg.oC.hb+a.dragCfg.cursorAt.right;a.dragCfg.oC.x=a.dragCfg.pointer.x-a.dragCfg.oC.wb+a.dragCfg.cursorAt.right}if(a.dragCfg.cursorAt.bottom){a.dragCfg.oR.y+=a.dragCfg.pointer.y-a.dragCfg.oC.y-a.dragCfg.oC.hb+a.dragCfg.cursorAt.bottom;a.dragCfg.oC.y=a.dragCfg.pointer.y-a.dragCfg.oC.hb+a.dragCfg.cursorAt.bottom}}a.dragCfg.nx=a.dragCfg.oR.x;a.dragCfg.ny=a.dragCfg.oR.y; if(a.dragCfg.insideParent||a.dragCfg.containment=="parent"){parentBorders=jQuery.iUtil.getBorder(a.parentNode,true);a.dragCfg.oC.x=a.offsetLeft+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.l:parentBorders.l);a.dragCfg.oC.y=a.offsetTop+(jQuery.browser.msie?0:jQuery.browser.opera?-parentBorders.t:parentBorders.t);jQuery(a.parentNode).append(jQuery.iDrag.helper.get(0))}if(a.dragCfg.containment){jQuery.iDrag.getContainment(a);a.dragCfg.onDragModifier.containment=jQuery.iDrag.fitToContainer}a.dragCfg.si&& jQuery.iSlider.modifyContainer(a);d.left=a.dragCfg.oC.x-a.dragCfg.diffX+"px";d.top=a.dragCfg.oC.y-a.dragCfg.diffY+"px";d.width=a.dragCfg.oC.wb+"px";d.height=a.dragCfg.oC.hb+"px";jQuery.iDrag.dragged.dragCfg.prot=false;if(a.dragCfg.gx)a.dragCfg.onDragModifier.grid=jQuery.iDrag.snapToGrid;a.dragCfg.zIndex!=false&&jQuery.iDrag.helper.css("zIndex",a.dragCfg.zIndex);if(a.dragCfg.opacity){jQuery.iDrag.helper.css("opacity",a.dragCfg.opacity);window.ActiveXObject&&jQuery.iDrag.helper.css("filter","alpha(opacity="+ a.dragCfg.opacity*100+")")}if(a.dragCfg.frameClass){jQuery.iDrag.helper.addClass(a.dragCfg.frameClass);jQuery.iDrag.helper.get(0).firstChild.style.display="none"}a.dragCfg.onStart&&a.dragCfg.onStart.apply(a,[c,a.dragCfg.oR.x,a.dragCfg.oR.y]);jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.highlight(a);if(a.dragCfg.ghosting==false)b.display="none";return false},getContainment:function(a){if(a.dragCfg.containment.constructor==String)if(a.dragCfg.containment=="parent"){a.dragCfg.cont=jQuery.extend({x:0, y:0},jQuery.iUtil.getSize(a.parentNode));var b=jQuery.iUtil.getBorder(a.parentNode,true);a.dragCfg.cont.w=a.dragCfg.cont.wb-b.l-b.r;a.dragCfg.cont.h=a.dragCfg.cont.hb-b.t-b.b}else{if(a.dragCfg.containment=="document"){b=jQuery.iUtil.getClient();a.dragCfg.cont={x:0,y:0,w:b.w,h:b.h}}}else if(a.dragCfg.containment.constructor==Array)a.dragCfg.cont={x:parseInt(a.dragCfg.containment[0])||0,y:parseInt(a.dragCfg.containment[1])||0,w:parseInt(a.dragCfg.containment[2])||0,h:parseInt(a.dragCfg.containment[3])|| 0};a.dragCfg.cont.dx=a.dragCfg.cont.x-a.dragCfg.oC.x;a.dragCfg.cont.dy=a.dragCfg.cont.y-a.dragCfg.oC.y},hidehelper:function(a){if(a.dragCfg.insideParent||a.dragCfg.containment=="parent")jQuery("body",document).append(jQuery.iDrag.helper.get(0));jQuery.iDrag.helper.empty().hide().css("opacity",1);window.ActiveXObject&&jQuery.iDrag.helper.css("filter","alpha(opacity=100)")},dragstop:function(){jQuery(document).unbind("mousemove",jQuery.iDrag.dragmove).unbind("mouseup",jQuery.iDrag.dragstop);if(jQuery.iDrag.dragged!= null){var a=jQuery.iDrag.dragged;jQuery.iDrag.dragged=null;if(a.dragCfg.init==false)return false;a.dragCfg.so==true&&jQuery(a).css("position",a.dragCfg.oP);a.si&&jQuery.iDrag.helper.css("cursor","move");a.dragCfg.frameClass&&jQuery.iDrag.helper.removeClass(a.dragCfg.frameClass);if(a.dragCfg.revert==false){if(a.dragCfg.fx>0){if(!a.dragCfg.axis||a.dragCfg.axis=="horizontally")(new jQuery.fx(a,{duration:a.dragCfg.fx},"left")).custom(a.dragCfg.oR.x,a.dragCfg.nRx);if(!a.dragCfg.axis||a.dragCfg.axis=="vertically")(new jQuery.fx(a, {duration:a.dragCfg.fx},"top")).custom(a.dragCfg.oR.y,a.dragCfg.nRy)}else{if(!a.dragCfg.axis||a.dragCfg.axis=="horizontally")a.style.left=a.dragCfg.nRx+"px";if(!a.dragCfg.axis||a.dragCfg.axis=="vertically")a.style.top=a.dragCfg.nRy+"px"}jQuery.iDrag.hidehelper(a);a.dragCfg.ghosting==false&&jQuery(a).css("display",a.dragCfg.oD)}else if(a.dragCfg.fx>0){a.dragCfg.prot=true;var b=false;if(jQuery.iDrop&&jQuery.iSort&&a.dragCfg.so)b=jQuery.iUtil.getPosition(jQuery.iSort.helper.get(0));jQuery.iDrag.helper.animate({left:b? b.x:a.dragCfg.oC.x,top:b?b.y:a.dragCfg.oC.y},a.dragCfg.fx,function(){a.dragCfg.prot=false;if(a.dragCfg.ghosting==false)a.style.display=a.dragCfg.oD;jQuery.iDrag.hidehelper(a)})}else{jQuery.iDrag.hidehelper(a);a.dragCfg.ghosting==false&&jQuery(a).css("display",a.dragCfg.oD)}jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.checkdrop(a);jQuery.iSort&&a.dragCfg.so&&jQuery.iSort.check(a);if(a.dragCfg.onChange&&(a.dragCfg.nRx!=a.dragCfg.oR.x||a.dragCfg.nRy!=a.dragCfg.oR.y))a.dragCfg.onChange.apply(a,a.dragCfg.lastSi|| [0,0,a.dragCfg.nRx,a.dragCfg.nRy]);a.dragCfg.onStop&&a.dragCfg.onStop.apply(a);return false}},snapToGrid:function(a,b,c,d){if(c!=0)c=parseInt((c+this.dragCfg.gx*c/Math.abs(c)/2)/this.dragCfg.gx)*this.dragCfg.gx;if(d!=0)d=parseInt((d+this.dragCfg.gy*d/Math.abs(d)/2)/this.dragCfg.gy)*this.dragCfg.gy;return{dx:c,dy:d,x:0,y:0}},fitToContainer:function(a,b,c,d){c=Math.min(Math.max(c,this.dragCfg.cont.dx),this.dragCfg.cont.w+this.dragCfg.cont.dx-this.dragCfg.oC.wb);d=Math.min(Math.max(d,this.dragCfg.cont.dy), this.dragCfg.cont.h+this.dragCfg.cont.dy-this.dragCfg.oC.hb);return{dx:c,dy:d,x:0,y:0}},dragmove:function(a){if(!(jQuery.iDrag.dragged==null||jQuery.iDrag.dragged.dragCfg.prot==true)){var b=jQuery.iDrag.dragged;b.dragCfg.currentPointer=jQuery.iUtil.getPointer(a);if(b.dragCfg.init==false){distance=Math.sqrt(Math.pow(b.dragCfg.pointer.x-b.dragCfg.currentPointer.x,2)+Math.pow(b.dragCfg.pointer.y-b.dragCfg.currentPointer.y,2));if(distance<b.dragCfg.snapDistance)return;else jQuery.iDrag.dragstart(a)}a= b.dragCfg.currentPointer.x-b.dragCfg.pointer.x;var c=b.dragCfg.currentPointer.y-b.dragCfg.pointer.y;for(var d in b.dragCfg.onDragModifier){var e=b.dragCfg.onDragModifier[d].apply(b,[b.dragCfg.oR.x+a,b.dragCfg.oR.y+c,a,c]);if(e&&e.constructor==Object){a=d!="user"?e.dx:e.x-b.dragCfg.oR.x;c=d!="user"?e.dy:e.y-b.dragCfg.oR.y}}b.dragCfg.nx=b.dragCfg.oC.x+a-b.dragCfg.diffX;b.dragCfg.ny=b.dragCfg.oC.y+c-b.dragCfg.diffY;if(b.dragCfg.si&&(b.dragCfg.onSlide||b.dragCfg.onChange))jQuery.iSlider.onSlide(b,b.dragCfg.nx, b.dragCfg.ny);b.dragCfg.onDrag&&b.dragCfg.onDrag.apply(b,[b.dragCfg.oR.x+a,b.dragCfg.oR.y+c]);if(!b.dragCfg.axis||b.dragCfg.axis=="horizontally"){b.dragCfg.nRx=b.dragCfg.oR.x+a;jQuery.iDrag.helper.get(0).style.left=b.dragCfg.nx+"px"}if(!b.dragCfg.axis||b.dragCfg.axis=="vertically"){b.dragCfg.nRy=b.dragCfg.oR.y+c;jQuery.iDrag.helper.get(0).style.top=b.dragCfg.ny+"px"}jQuery.iDrop&&jQuery.iDrop.count>0&&jQuery.iDrop.checkhover(b);return false}},build:function(a){if(!jQuery.iDrag.helper){jQuery("body", document).append('<div id="dragHelper"></div>');jQuery.iDrag.helper=jQuery("#dragHelper");var b=jQuery.iDrag.helper.get(0),c=b.style;c.position="absolute";c.display="none";c.cursor="move";c.listStyle="none";c.overflow="hidden";if(window.ActiveXObject)b.unselectable="on";else{c.mozUserSelect="none";c.userSelect="none";c.KhtmlUserSelect="none"}}a||(a={});return this.each(function(){if(!(this.isDraggable||!jQuery.iUtil)){if(window.ActiveXObject){this.onselectstart=function(){return false};this.ondragstart= function(){return false}}var d=this,e=a.handle?jQuery(this).find(a.handle):jQuery(this);if(jQuery.browser.msie)e.each(function(){this.unselectable="on"});else{e.css("-moz-user-select","none");e.css("user-select","none");e.css("-khtml-user-select","none")}this.dragCfg={dhe:e,revert:a.revert?true:false,ghosting:a.ghosting?true:false,so:a.so?a.so:false,si:a.si?a.si:false,insideParent:a.insideParent?a.insideParent:false,zIndex:a.zIndex?parseInt(a.zIndex)||0:false,opacity:a.opacity?parseFloat(a.opacity): false,fx:parseInt(a.fx)||null,hpc:a.hpc?a.hpc:false,onDragModifier:{},pointer:{},onStart:a.onStart&&a.onStart.constructor==Function?a.onStart:false,onStop:a.onStop&&a.onStop.constructor==Function?a.onStop:false,onChange:a.onChange&&a.onChange.constructor==Function?a.onChange:false,axis:/vertically|horizontally/.test(a.axis)?a.axis:false,snapDistance:a.snapDistance?parseInt(a.snapDistance)||0:0,cursorAt:a.cursorAt?a.cursorAt:false,autoSize:a.autoSize?true:false,frameClass:a.frameClass||false};if(a.onDragModifier&& a.onDragModifier.constructor==Function)this.dragCfg.onDragModifier.user=a.onDragModifier;if(a.onDrag&&a.onDrag.constructor==Function)this.dragCfg.onDrag=a.onDrag;if(a.containment&&(a.containment.constructor==String&&(a.containment=="parent"||a.containment=="document")||a.containment.constructor==Array&&a.containment.length==4))this.dragCfg.containment=a.containment;if(a.fractions)this.dragCfg.fractions=a.fractions;if(a.grid)if(typeof a.grid=="number"){this.dragCfg.gx=parseInt(a.grid)||1;this.dragCfg.gy= parseInt(a.grid)||1}else if(a.grid.length==2){this.dragCfg.gx=parseInt(a.grid[0])||1;this.dragCfg.gy=parseInt(a.grid[1])||1}if(a.onSlide&&a.onSlide.constructor==Function)this.dragCfg.onSlide=a.onSlide;this.isDraggable=true;e.each(function(){this.dragElem=d});e.bind("mousedown",jQuery.iDrag.draginit)}})}};jQuery.fn.extend({DraggableDestroy:jQuery.iDrag.destroy,Draggable:jQuery.iDrag.build});