jQuery.iSort={changed:[],collected:{},helper:false,inFrontOf:null,start:function(){if(jQuery.iDrag.dragged!=null){var b,c;jQuery.iSort.helper.get(0).className=jQuery.iDrag.dragged.dragCfg.hpc;b=jQuery.iSort.helper.get(0).style;b.display="block";jQuery.iSort.helper.oC=jQuery.extend(jQuery.iUtil.getPosition(jQuery.iSort.helper.get(0)),jQuery.iUtil.getSize(jQuery.iSort.helper.get(0)));b.width=jQuery.iDrag.dragged.dragCfg.oC.wb+"px";b.height=jQuery.iDrag.dragged.dragCfg.oC.hb+"px";c=jQuery.iUtil.getMargins(jQuery.iDrag.dragged); b.marginTop=c.t;b.marginRight=c.r;b.marginBottom=c.b;b.marginLeft=c.l;if(jQuery.iDrag.dragged.dragCfg.ghosting==true){b=jQuery.iDrag.dragged.cloneNode(true);c=b.style;c.marginTop="0px";c.marginRight="0px";c.marginBottom="0px";c.marginLeft="0px";c.display="block";jQuery.iSort.helper.empty().append(b)}jQuery(jQuery.iDrag.dragged).after(jQuery.iSort.helper.get(0));jQuery.iDrag.dragged.style.display="none"}},check:function(b){if(!b.dragCfg.so&&jQuery.iDrop.overzone.sortable){b.dragCfg.onStop&&b.dragCfg.onStop.apply(dragged); jQuery(b).css("position",b.dragCfg.initialPosition||b.dragCfg.oP);jQuery(b).DraggableDestroy();jQuery(jQuery.iDrop.overzone).SortableAddItem(b)}jQuery.iSort.helper.removeClass(b.dragCfg.hpc).html("&nbsp;");jQuery.iSort.inFrontOf=null;jQuery.iSort.helper.get(0).style.display="none";jQuery.iSort.helper.after(b);b.dragCfg.fx>0&&jQuery(b).fadeIn(b.dragCfg.fx);jQuery("body").append(jQuery.iSort.helper.get(0));b=[];for(var c=false,d=0;d<jQuery.iSort.changed.length;d++){var e=jQuery.iDrop.zones[jQuery.iSort.changed[d]].get(0), g=jQuery.attr(e,"id"),f=jQuery.iSort.serialize(g);if(e.dropCfg.os!=f.hash){e.dropCfg.os=f.hash;if(c==false&&e.dropCfg.onChange)c=e.dropCfg.onChange;f.id=g;b[b.length]=f}}jQuery.iSort.changed=[];c!=false&&b.length>0&&c(b)},checkhover:function(b){if(jQuery.iDrag.dragged){var c=false,d=0;if(b.dropCfg.el.size()>0)for(d=b.dropCfg.el.size();d>0;d--)if(b.dropCfg.el.get(d-1)!=jQuery.iDrag.dragged)if(b.sortCfg.floats){if(b.dropCfg.el.get(d-1).pos.x+b.dropCfg.el.get(d-1).pos.wb/2>jQuery.iDrag.dragged.dragCfg.nx&& b.dropCfg.el.get(d-1).pos.y+b.dropCfg.el.get(d-1).pos.hb/2>jQuery.iDrag.dragged.dragCfg.ny)c=b.dropCfg.el.get(d-1)}else if(b.dropCfg.el.get(d-1).pos.y+b.dropCfg.el.get(d-1).pos.hb/2>jQuery.iDrag.dragged.dragCfg.ny)c=b.dropCfg.el.get(d-1);else break;if(c&&jQuery.iSort.inFrontOf!=c){jQuery.iSort.inFrontOf=c;jQuery(c).before(jQuery.iSort.helper.get(0))}else if(!c&&(jQuery.iSort.inFrontOf!=null||jQuery.iSort.helper.get(0).parentNode!=b)){jQuery.iSort.inFrontOf=null;jQuery(b).append(jQuery.iSort.helper.get(0))}jQuery.iSort.helper.get(0).style.display= "block"}},measure:function(b){jQuery.iDrag.dragged!=null&&b.dropCfg.el.each(function(){this.pos=jQuery.extend(jQuery.iUtil.getSizeLite(this),jQuery.iUtil.getPositionLite(this))})},serialize:function(b){var c,d="",e={};if(b)if(jQuery.iSort.collected[b]){e[b]=[];jQuery("#"+b+" ."+jQuery.iSort.collected[b]).each(function(){if(d.length>0)d+="&";d+=b+"[]="+jQuery.attr(this,"id");e[b][e[b].length]=jQuery.attr(this,"id")})}else for(a in b){if(jQuery.iSort.collected[b[a]]){e[b[a]]=[];jQuery("#"+b[a]+" ."+ jQuery.iSort.collected[b[a]]).each(function(){if(d.length>0)d+="&";d+=b[a]+"[]="+jQuery.attr(this,"id");e[b[a]][e[b[a]].length]=jQuery.attr(this,"id")})}}else for(c in jQuery.iSort.collected){e[c]=[];jQuery("#"+c+" ."+jQuery.iSort.collected[c]).each(function(){if(d.length>0)d+="&";d+=c+"[]="+jQuery.attr(this,"id");e[c][e[c].length]=jQuery.attr(this,"id")})}return{hash:d,o:e}},addItem:function(b){if(b.childNodes)return this.each(function(){if(!this.sortCfg||!jQuery(b).is("."+this.sortCfg.accept))jQuery(b).addClass(this.sortCfg.accept); jQuery(b).Draggable(this.sortCfg.dragCfg)})},destroy:function(){return this.each(function(){jQuery("."+this.sortCfg.accept).DraggableDestroy();jQuery(this).DroppableDestroy();this.isSortable=this.sortCfg=null})},build:function(b){if(b.accept&&jQuery.iUtil&&jQuery.iDrag&&jQuery.iDrop){if(!jQuery.iSort.helper){jQuery("body",document).append('<div id="sortHelper">&nbsp;</div>');jQuery.iSort.helper=jQuery("#sortHelper");jQuery.iSort.helper.get(0).style.display="none"}this.Droppable({accept:b.accept,activeclass:b.activeclass? b.activeclass:false,hoverclass:b.hoverclass?b.hoverclass:false,helperclass:b.helperclass?b.helperclass:false,onHover:b.onHover||b.onhover,onOut:b.onOut||b.onout,sortable:true,onChange:b.onChange||b.onchange,fx:b.fx?b.fx:false,ghosting:b.ghosting?true:false,tolerance:b.tolerance?b.tolerance:"intersect"});return this.each(function(){var c={revert:b.revert?true:false,zindex:3E3,opacity:b.opacity?parseFloat(b.opacity):false,hpc:b.helperclass?b.helperclass:false,fx:b.fx?b.fx:false,so:true,ghosting:b.ghosting? true:false,handle:b.handle?b.handle:null,containment:b.containment?b.containment:null,onStart:b.onStart&&b.onStart.constructor==Function?b.onStart:false,onDrag:b.onDrag&&b.onDrag.constructor==Function?b.onDrag:false,onStop:b.onStop&&b.onStop.constructor==Function?b.onStop:false,axis:/vertically|horizontally/.test(b.axis)?b.axis:false,snapDistance:b.snapDistance?parseInt(b.snapDistance)||0:false,cursorAt:b.cursorAt?b.cursorAt:false};jQuery("."+b.accept,this).Draggable(c);this.isSortable=true;this.sortCfg= {accept:b.accept,revert:b.revert?true:false,zindex:3E3,opacity:b.opacity?parseFloat(b.opacity):false,hpc:b.helperclass?b.helperclass:false,fx:b.fx?b.fx:false,so:true,ghosting:b.ghosting?true:false,handle:b.handle?b.handle:null,containment:b.containment?b.containment:null,floats:b.floats?true:false,dragCfg:c}})}}};jQuery.fn.extend({Sortable:jQuery.iSort.build,SortableAddItem:jQuery.iSort.addItem,SortableDestroy:jQuery.iSort.destroy});jQuery.SortSerialize=jQuery.iSort.serialize;